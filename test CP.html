<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Cong√©s</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- SheetJS pour lire les fichiers Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDH9xrEByGfjpnJMbcrZzl20A_7cXNUBRk",
            authDomain: "gestion-conges-820b7.firebaseapp.com",
            projectId: "gestion-conges-820b7",
            storageBucket: "gestion-conges-820b7.firebasestorage.app",
            messagingSenderId: "1054299846910",
            appId: "1:1054299846910:web:a184c4cdf03cb9c6e14daf"
        };

        // Variables globales
        let db = null;
        let currentTab = 'login';
        let currentUser = null;
        let allEmployees = [];

        // Initialisation Firebase
        function initializeFirebaseApp() {
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                console.log('Firebase initialis√© avec succ√®s');
                
                document.getElementById('firebaseStatus').innerHTML = `
                    <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6 rounded">
                        <p class="font-bold">‚úÖ Firebase configur√©</p>
                        <p>Application pr√™te avec gestion des identifiants salari√©s.</p>
                    </div>
                `;
                
                // Charger les employ√©s au d√©marrage
                loadEmployees();
                setTimeout(updateEmployeeCount, 1000);
                
            } catch (error) {
                console.error('Erreur d\'initialisation Firebase:', error);
                document.getElementById('firebaseStatus').innerHTML = `
                    <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded">
                        <p class="font-bold">‚ùå Erreur Firebase</p>
                        <p>Erreur: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Charger la liste des employ√©s
        function loadEmployees() {
            if (!db) return;
            
            console.log('Chargement des employ√©s...');
            db.collection('employees').get().then((querySnapshot) => {
                allEmployees = [];
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    allEmployees.push({ id: doc.id, ...data });
                    console.log('Employ√© charg√©:', data.employeeId, data.firstName, data.lastName);
                });
                console.log(`${allEmployees.length} employ√©s charg√©s au total`);
                
                // Mettre √† jour l'indicateur
                updateEmployeeCount();
                
            }).catch((error) => {
                console.error('Erreur lors du chargement des employ√©s:', error);
            });
        }

        // Mettre √† jour l'indicateur du nombre d'employ√©s
        function updateEmployeeCount() {
            const indicator = document.getElementById('employeeCount');
            if (indicator) {
                indicator.textContent = `${allEmployees.length} employ√©s dans la base`;
            }
        }

        // Gestion de l'affichage des onglets selon le r√¥le
        function updateTabsVisibility() {
            const loginTab = document.getElementById('loginTab');
            const employeeTab = document.getElementById('employeeTab');
            const employerTab = document.getElementById('employerTab');
            const adminTab = document.getElementById('adminTab');

            // R√©initialiser - tous visibles
            [loginTab, employeeTab, employerTab, adminTab].forEach(tab => {
                if (tab) tab.classList.remove('hidden');
            });

            if (!currentUser) {
                // Utilisateur non connect√© - seul l'onglet connexion
                employeeTab?.classList.add('hidden');
                employerTab?.classList.add('hidden');
                adminTab?.classList.add('hidden');
            } else if (currentUser.role === 'employer') {
                // Employeur - acc√®s √† tout (tous les onglets restent visibles)
                console.log('Employeur connect√© - tous les onglets visibles');
            } else {
                // Salari√© - acc√®s limit√©
                employerTab?.classList.add('hidden');
                adminTab?.classList.add('hidden');
                console.log('Salari√© connect√© - onglets Employeur et Administration masqu√©s');
            }
        }
        function showTab(tabName) {
            const tabs = ['login', 'employee', 'employer', 'admin'];
            tabs.forEach(tab => {
                const tabElement = document.getElementById(tab + 'Tab');
                const panelElement = document.getElementById(tab + 'Panel');
                
                if (tabElement && panelElement) {
                    tabElement.classList.remove('bg-blue-500', 'text-white');
                    tabElement.classList.add('bg-gray-200', 'text-gray-700');
                    panelElement.classList.add('hidden');
                }
            });
            
            const activeTab = document.getElementById(tabName + 'Tab');
            const activePanel = document.getElementById(tabName + 'Panel');
            
            if (activeTab && activePanel) {
                activeTab.classList.remove('bg-gray-200', 'text-gray-700');
                activeTab.classList.add('bg-blue-500', 'text-white');
                activePanel.classList.remove('hidden');
            }
            
            currentTab = tabName;
            
            if (tabName === 'employee' || tabName === 'employer') {
                loadLeaveRequests();
            }
        }

        // Connexion par identifiant
        function loginEmployee() {
            const employeeId = document.getElementById('loginEmployeeId').value.trim();
            
            console.log('Tentative de connexion avec ID:', employeeId);
            console.log('Nombre d\'employ√©s disponibles:', allEmployees.length);
            
            if (!employeeId) {
                alert('Veuillez saisir votre identifiant');
                return;
            }

            if (allEmployees.length === 0) {
                alert('Aucun employ√© n\'est encore import√©. Contactez l\'administrateur.');
                console.log('Liste des employ√©s vide');
                return;
            }

            // Rechercher l'employ√© (insensible √† la casse)
            console.log('Recherche de l\'employ√©...');
            const employee = allEmployees.find(emp => {
                const empId = emp.employeeId;
                console.log('Comparaison:', empId, 'avec', employeeId);
                return empId && empId.toString().toLowerCase() === employeeId.toLowerCase();
            });

            console.log('Employ√© trouv√©:', employee);

            if (employee) {
                currentUser = employee;
                console.log('Connexion r√©ussie pour:', employee.firstName, employee.lastName);
                
                document.getElementById('userInfo').innerHTML = `
                    <div class="bg-blue-100 border border-blue-300 text-blue-700 px-3 py-2 rounded text-sm mb-4">
                        üë§ Connect√©: ${employee.firstName} ${employee.lastName} (${employee.employeeId}) - <em>Salari√©</em>
                        <button onclick="logout()" class="ml-2 text-red-600 hover:text-red-800">D√©connexion</button>
                    </div>
                `;
                
                // Mettre √† jour la visibilit√© des onglets
                updateTabsVisibility();
                showTab('employee');
                document.getElementById('loginEmployeeId').value = '';
            } else {
                console.log('Identifiant non trouv√©');
                console.log('IDs disponibles:', allEmployees.map(emp => emp.employeeId));
                alert(`Identifiant "${employeeId}" non trouv√©.\n\nIDs disponibles: ${allEmployees.map(emp => emp.employeeId).slice(0, 5).join(', ')}${allEmployees.length > 5 ? '...' : ''}`);
            }
        }

        // Afficher les IDs disponibles
        function showAvailableIds() {
            if (allEmployees.length === 0) {
                alert('Aucun employ√© import√© pour le moment.');
                return;
            }

            const ids = allEmployees.map(emp => `${emp.employeeId} (${emp.firstName} ${emp.lastName})`);
            const message = `IDs d'employ√©s disponibles:\n\n${ids.slice(0, 10).join('\n')}${ids.length > 10 ? `\n\n... et ${ids.length - 10} autres` : ''}`;
            
            alert(message);
        }
        function loginEmployer() {
            const password = document.getElementById('loginPassword').value;
            
            if (password === 'admin123') { // Mot de passe simple pour la d√©mo
                currentUser = { role: 'employer', name: 'Administrateur' };
                document.getElementById('userInfo').innerHTML = `
                    <div class="bg-green-100 border border-green-300 text-green-700 px-3 py-2 rounded text-sm mb-4">
                        üëë Connect√©: Administrateur - <em>Employeur</em>
                        <button onclick="logout()" class="ml-2 text-red-600 hover:text-red-800">D√©connexion</button>
                    </div>
                `;
                showTab('employer');
                document.getElementById('loginPassword').value = '';
            } else {
                alert('Mot de passe incorrect');
            }
        }

        // D√©connexion
        function logout() {
            currentUser = null;
            document.getElementById('userInfo').innerHTML = '';
            
            // Remettre tous les onglets visibles pour la connexion
            updateTabsVisibility();
            showTab('login');
        }

        // Import Excel
        function handleExcelFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);

                    displayExcelPreview(jsonData);
                } catch (error) {
                    alert('Erreur lors de la lecture du fichier Excel: ' + error.message);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // Afficher l'aper√ßu des donn√©es Excel
        function displayExcelPreview(data) {
            if (data.length === 0) {
                alert('Le fichier Excel est vide');
                return;
            }

            const preview = document.getElementById('excelPreview');
            const headers = Object.keys(data[0]);
            
            let html = `
                <div class="bg-gray-50 p-4 rounded mb-4">
                    <h3 class="font-semibold mb-2">Aper√ßu des donn√©es (${data.length} lignes)</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead>
                                <tr class="bg-gray-200">
                                    ${headers.map(header => `<th class="p-2 text-left">${header}</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                ${data.slice(0, 5).map(row => `
                                    <tr class="border-b">
                                        ${headers.map(header => `<td class="p-2">${row[header] || ''}</td>`).join('')}
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    ${data.length > 5 ? `<p class="text-gray-500 mt-2">... et ${data.length - 5} autres lignes</p>` : ''}
                </div>
                <button onclick="importEmployees(${JSON.stringify(data).replace(/"/g, '&quot;')})" 
                        class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    Importer les employ√©s
                </button>
            `;
            
            preview.innerHTML = html;
        }

        // Importer les employ√©s dans Firestore
        function importEmployees(data) {
            if (!db) {
                alert('Firebase non disponible');
                return;
            }

            const batch = db.batch();
            let importCount = 0;

            data.forEach((row, index) => {
                // Mapping flexible des colonnes
                const employee = {
                    employeeId: row['ID'] || row['id'] || row['Identifiant'] || row['Employee ID'] || `EMP${String(index + 1).padStart(3, '0')}`,
                    firstName: row['Pr√©nom'] || row['First Name'] || row['firstname'] || row['prenom'] || '',
                    lastName: row['Nom'] || row['Last Name'] || row['lastname'] || row['nom'] || '',
                    email: row['Email'] || row['email'] || row['E-mail'] || '',
                    department: row['Service'] || row['Department'] || row['department'] || row['service'] || '',
                    position: row['Poste'] || row['Position'] || row['position'] || row['poste'] || '',
                    manager: row['Manager'] || row['manager'] || row['Responsable'] || row['responsable'] || '',
                    createdAt: new Date().toISOString()
                };

                // V√©rifier que les champs essentiels sont pr√©sents
                if (employee.employeeId && (employee.firstName || employee.lastName)) {
                    const docRef = db.collection('employees').doc();
                    batch.set(docRef, employee);
                    importCount++;
                }
            });

            batch.commit().then(() => {
                alert(`‚úÖ ${importCount} employ√©s import√©s avec succ√®s !`);
                loadEmployees();
                document.getElementById('excelPreview').innerHTML = '';
                document.getElementById('excelFile').value = '';
            }).catch((error) => {
                console.error('Erreur lors de l\'import:', error);
                alert('‚ùå Erreur lors de l\'import: ' + error.message);
            });
        }

        // Afficher la liste des employ√©s
        function displayEmployeesList() {
            const container = document.getElementById('employeesList');
            if (!container) return;

            if (allEmployees.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">Aucun employ√© trouv√©</p>';
                return;
            }

            container.innerHTML = allEmployees.map(employee => `
                <div class="bg-white border rounded-lg p-4 shadow">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-semibold">${employee.firstName} ${employee.lastName}</h3>
                            <p class="text-gray-600">ID: ${employee.employeeId}</p>
                            ${employee.email ? `<p class="text-gray-600">üìß ${employee.email}</p>` : ''}
                            ${employee.department ? `<p class="text-gray-600">üè¢ ${employee.department}</p>` : ''}
                            ${employee.position ? `<p class="text-gray-600">üíº ${employee.position}</p>` : ''}
                        </div>
                        <button onclick="deleteEmployee('${employee.id}')" 
                                class="bg-red-500 text-white px-2 py-1 rounded text-sm hover:bg-red-600">
                            Supprimer
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Supprimer un employ√©
        function deleteEmployee(employeeId) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cet employ√© ?')) return;

            db.collection('employees').doc(employeeId).delete().then(() => {
                alert('‚úÖ Employ√© supprim√©');
                loadEmployees();
                setTimeout(displayEmployeesList, 500);
            }).catch((error) => {
                alert('‚ùå Erreur: ' + error.message);
            });
        }

        // Soumettre une demande de cong√©
        function submitLeaveRequest() {
            if (!db || !currentUser) {
                alert('‚è≥ Veuillez vous connecter');
                return;
            }

            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const leaveType = document.getElementById('leaveType').value;
            const reason = document.getElementById('reason').value;

            if (!startDate || !endDate || !leaveType) {
                alert('Veuillez remplir tous les champs obligatoires');
                return;
            }

            if (new Date(startDate) > new Date(endDate)) {
                alert('La date de d√©but ne peut pas √™tre post√©rieure √† la date de fin');
                return;
            }

            const submitButton = document.querySelector('button[type="submit"]');
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.textContent = 'Envoi en cours...';
            }

            db.collection('leaveRequests').add({
                employeeName: `${currentUser.firstName} ${currentUser.lastName}`,
                employeeId: currentUser.employeeId,
                startDate: startDate,
                endDate: endDate,
                leaveType: leaveType,
                reason: reason,
                status: 'En attente',
                submittedAt: firebase.firestore.FieldValue.serverTimestamp(),
                userId: currentUser.id || currentUser.employeeId,
                submittedDate: new Date().toISOString()
            }).then(() => {
                alert('‚úÖ Demande de cong√© soumise avec succ√®s !');
                document.getElementById('leaveForm').reset();
                loadLeaveRequests();
            }).catch((error) => {
                console.error('Erreur lors de la soumission :', error);
                alert('‚ùå Erreur: ' + error.message);
            }).finally(() => {
                if (submitButton) {
                    submitButton.disabled = false;
                    submitButton.textContent = 'Soumettre la demande';
                }
            });
        }

        // Charger les demandes de cong√©s
        function loadLeaveRequests() {
            if (!db || !currentUser) return;

            db.collection('leaveRequests')
                .orderBy('submittedAt', 'desc')
                .onSnapshot((querySnapshot) => {
                    const requests = [];
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        requests.push({ 
                            id: doc.id, 
                            ...data,
                            submittedAt: data.submittedAt || new Date()
                        });
                    });
                    
                    if (currentTab === 'employer') {
                        displayEmployerRequests(requests);
                    } else if (currentTab === 'employee') {
                        const userRequests = requests.filter(req => 
                            req.userId === (currentUser.id || currentUser.employeeId) ||
                            req.employeeId === currentUser.employeeId
                        );
                        displayEmployeeRequests(userRequests);
                    }
                }, (error) => {
                    console.error('Erreur lors du chargement :', error);
                });
        }

        // Afficher les demandes pour l'employ√©
        function displayEmployeeRequests(requests) {
            const container = document.getElementById('employeeRequests');
            if (!container) return;
            
            if (requests.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">Aucune demande de cong√© trouv√©e</p>';
                return;
            }

            container.innerHTML = requests.map(request => `
                <div class="bg-white border rounded-lg p-4 shadow">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-semibold text-lg">${request.leaveType}</h3>
                        <span class="px-2 py-1 rounded text-sm font-medium ${getStatusStyle(request.status)}">
                            ${request.status}
                        </span>
                    </div>
                    <p class="text-gray-600 mb-2">
                        Du ${formatDate(request.startDate)} au ${formatDate(request.endDate)}
                    </p>
                    ${request.reason ? `<p class="text-gray-700 mb-2"><strong>Motif :</strong> ${request.reason}</p>` : ''}
                    <p class="text-sm text-gray-500">
                        Soumise le ${formatDateTime(request.submittedAt)}
                    </p>
                </div>
            `).join('');
        }

        // Afficher les demandes pour l'employeur
        function displayEmployerRequests(requests) {
            const container = document.getElementById('employerRequests');
            if (!container) return;
            
            if (requests.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">Aucune demande de cong√© trouv√©e</p>';
                return;
            }

            container.innerHTML = requests.map(request => `
                <div class="bg-white border rounded-lg p-4 shadow">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h3 class="font-semibold text-lg">${request.employeeName}</h3>
                            <p class="text-gray-600">${request.leaveType}</p>
                            ${request.employeeId ? `<p class="text-sm text-gray-500">ID: ${request.employeeId}</p>` : ''}
                        </div>
                        <span class="px-2 py-1 rounded text-sm font-medium ${getStatusStyle(request.status)}">
                            ${request.status}
                        </span>
                    </div>
                    <p class="text-gray-600 mb-2">
                        Du ${formatDate(request.startDate)} au ${formatDate(request.endDate)}
                    </p>
                    ${request.reason ? `<p class="text-gray-700 mb-3"><strong>Motif :</strong> ${request.reason}</p>` : ''}
                    <p class="text-sm text-gray-500 mb-3">
                        Soumise le ${formatDateTime(request.submittedAt)}
                    </p>
                    ${request.status === 'En attente' ? `
                        <div class="flex space-x-2">
                            <button onclick="updateRequestStatus('${request.id}', 'Approuv√©e')" 
                                    class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 text-sm">
                                Approuver
                            </button>
                            <button onclick="updateRequestStatus('${request.id}', 'Refus√©e')" 
                                    class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-sm">
                                Refuser
                            </button>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // Mettre √† jour le statut d'une demande
        function updateRequestStatus(requestId, status) {
            if (!db) return;

            db.collection('leaveRequests').doc(requestId).update({
                status: status,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                alert(`‚úÖ Demande ${status.toLowerCase()} avec succ√®s !`);
            }).catch((error) => {
                console.error('Erreur lors de la mise √† jour :', error);
                alert('‚ùå Erreur: ' + error.message);
            });
        }

        // Utilitaires
        function getStatusStyle(status) {
            switch (status) {
                case 'En attente': return 'bg-yellow-100 text-yellow-800';
                case 'Approuv√©e': return 'bg-green-100 text-green-800';
                case 'Refus√©e': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function formatDate(dateString) {
            if (!dateString) return 'Date inconnue';
            return new Date(dateString).toLocaleDateString('fr-FR');
        }

        function formatDateTime(timestamp) {
            if (!timestamp) return 'Date inconnue';
            if (timestamp.toDate) return timestamp.toDate().toLocaleString('fr-FR');
            if (timestamp instanceof Date) return timestamp.toLocaleString('fr-FR');
            return new Date(timestamp).toLocaleString('fr-FR');
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM charg√©, initialisation...');
            
            if (typeof firebase === 'undefined') {
                document.getElementById('firebaseStatus').innerHTML = `
                    <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded">
                        <p class="font-bold">‚ùå Firebase non charg√©</p>
                        <p>Veuillez rafra√Æchir la page.</p>
                    </div>
                `;
                return;
            }

            initializeFirebaseApp();
            updateTabsVisibility(); // Initialiser la visibilit√© des onglets
            showTab('login');
            
            // Configuration des dates
            const today = new Date().toISOString().split('T')[0];
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            
            if (startDateInput) startDateInput.min = today;
            if (endDateInput) endDateInput.min = today;
            
            if (startDateInput && endDateInput) {
                startDateInput.addEventListener('change', function() {
                    endDateInput.min = this.value;
                    if (endDateInput.value && endDateInput.value < this.value) {
                        endDateInput.value = this.value;
                    }
                });
            }

            // Gestion Entr√©e pour les formulaires de connexion
            document.getElementById('loginEmployeeId').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') loginEmployee();
            });
            
            document.getElementById('loginPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') loginEmployer();
            });
        });
    </script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Gestion des Cong√©s</h1>
            <p class="text-gray-600">Syst√®me de gestion avec identifiants salari√©s</p>
        </header>

        <!-- Status Firebase -->
        <div id="firebaseStatus">
            <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 mb-6 rounded">
                <p class="font-bold">üîÑ Initialisation Firebase...</p>
                <p>Connexion en cours...</p>
            </div>
        </div>

        <!-- Informations utilisateur connect√© -->
        <div id="userInfo"></div>

        <!-- Onglets -->
        <div class="flex justify-center mb-6">
            <div class="bg-white rounded-lg p-1 shadow">
                <button id="loginTab" onclick="showTab('login')" 
                        class="px-4 py-2 rounded-md font-medium transition-colors text-sm">
                    Connexion
                </button>
                <button id="employeeTab" onclick="showTab('employee')" 
                        class="px-4 py-2 rounded-md font-medium transition-colors text-sm">
                    Salari√©
                </button>
                <button id="employerTab" onclick="showTab('employer')" 
                        class="px-4 py-2 rounded-md font-medium transition-colors text-sm">
                    Employeur
                </button>
                <button id="adminTab" onclick="showTab('admin')" 
                        class="px-4 py-2 rounded-md font-medium transition-colors text-sm">
                    Administration
                </button>
            </div>
        </div>

        <!-- Panel Connexion -->
        <div id="loginPanel" class="hidden">
            <div class="max-w-md mx-auto">
                <div class="bg-white rounded-lg shadow-md p-6 mb-4">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Connexion Salari√©</h2>
                    
                    <!-- Indicateur nombre d'employ√©s -->
                    <div class="bg-gray-50 p-3 rounded mb-4">
                        <p class="text-sm text-gray-600">
                            üìä <span id="employeeCount">Chargement des employ√©s...</span>
                        </p>
                        <button onclick="loadEmployees(); setTimeout(updateEmployeeCount, 1000);" 
                                class="text-blue-600 hover:text-blue-800 text-sm underline">
                            Actualiser
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label for="loginEmployeeId" class="block text-sm font-medium text-gray-700 mb-1">
                                Identifiant employ√©
                            </label>
                            <input type="text" id="loginEmployeeId" 
                                   class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="Votre identifiant">
                        </div>
                        
                        <!-- Bouton de test -->
                        <div class="flex space-x-2">
                            <button onclick="loginEmployee()" 
                                    class="flex-1 bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600">
                                Se connecter
                            </button>
                            <button onclick="showAvailableIds()" 
                                    class="bg-gray-500 text-white py-2 px-3 rounded-md hover:bg-gray-600 text-sm">
                                Voir IDs
                            </button>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Connexion Employeur</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-1">
                                Mot de passe
                            </label>
                            <input type="password" id="loginPassword" 
                                   class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="admin123">
                        </div>
                        <button onclick="loginEmployer()" 
                                class="w-full bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600">
                            Se connecter
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel Salari√© -->
        <div id="employeePanel" class="hidden">
            <div class="max-w-2xl mx-auto">
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Nouvelle demande de cong√©</h2>
                    
                    <form id="leaveForm" class="space-y-4" onsubmit="event.preventDefault(); submitLeaveRequest();">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="startDate" class="block text-sm font-medium text-gray-700 mb-1">
                                    Date de d√©but *
                                </label>
                                <input type="date" id="startDate" required
                                       class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="endDate" class="block text-sm font-medium text-gray-700 mb-1">
                                    Date de fin *
                                </label>
                                <input type="date" id="endDate" required
                                       class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <div>
                            <label for="leaveType" class="block text-sm font-medium text-gray-700 mb-1">
                                Type de cong√© *
                            </label>
                            <select id="leaveType" required
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">S√©lectionner un type</option>
                                <option value="Cong√©s pay√©s">Cong√©s pay√©s</option>
                                <option value="Cong√© maladie">Cong√© maladie</option>
                                <option value="Cong√© maternit√©/paternit√©">Cong√© maternit√©/paternit√©</option>
                                <option value="Cong√© sans solde">Cong√© sans solde</option>
                                <option value="RTT">RTT</option>
                                <option value="Autre">Autre</option>
                            </select>
                        </div>

                        <div>
                            <label for="reason" class="block text-sm font-medium text-gray-700 mb-1">
                                Motif (optionnel)
                            </label>
                            <textarea id="reason" rows="3"
                                      class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                      placeholder="Pr√©cisez le motif de votre demande..."></textarea>
                        </div>

                        <button type="submit"
                                class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-colors font-medium">
                            Soumettre la demande
                        </button>
                    </form>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Mes demandes de cong√©s</h2>
                    <div id="employeeRequests" class="space-y-4">
                        <p class="text-gray-500 text-center py-4">Chargement...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel Employeur -->
        <div id="employerPanel" class="hidden">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Gestion des demandes de cong√©s</h2>
                    <div id="employerRequests" class="space-y-4">
                        <p class="text-gray-500 text-center py-4">Chargement...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel Administration -->
        <div id="adminPanel" class="hidden">
            <div class="max-w-4xl mx-auto space-y-6">
                <!-- Import Excel -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Import des employ√©s (Excel)</h2>
                    
                    <div class="bg-yellow-50 border border-yellow-200 rounded p-4 mb-4">
                        <p class="text-sm text-yellow-800">
                            <strong>Format attendu :</strong> Colonnes Excel avec headers comme : 
                            ID/Identifiant, Pr√©nom/First Name, Nom/Last Name, Email, Service/Department, Poste/Position
                        </p>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label for="excelFile" class="block text-sm font-medium text-gray-700 mb-1">
                                S√©lectionner un fichier Excel
                            </label>
                            <input type="file" id="excelFile" accept=".xlsx,.xls" 
                                   onchange="handleExcelFile(event)"
                                   class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div id="excelPreview"></div>
                    </div>
                </div>

                <!-- Liste des employ√©s -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800">Liste des employ√©s</h2>
                        <button onclick="loadEmployees(); setTimeout(displayEmployeesList, 500);" 
                                class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">
                            Actualiser
                        </button>
                    </div>
                    <div id="employeesList" class="space-y-4">
                        <p class="text-gray-500 text-center py-4">Chargement...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>